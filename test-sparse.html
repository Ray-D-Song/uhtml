<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UHTML Sparse Attributes Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <h1>UHTML Sparse Attributes Test</h1>
    <p>Testing the new sparse attributes functionality in uHTML.</p>
    
    <div id="test-container"></div>
    
    <div id="results"></div>

    <script type="module">
        import { render, html } from './esm/index.js';

        const container = document.getElementById('test-container');
        const results = document.getElementById('results');
        
        function addResult(testName, passed, expected, actual) {
            const div = document.createElement('div');
            div.className = `test ${passed ? 'success' : 'error'}`;
            div.innerHTML = `
                <h3>${testName}: ${passed ? 'PASSED' : 'FAILED'}</h3>
                <p><strong>Expected:</strong> ${expected}</p>
                <p><strong>Actual:</strong> ${actual}</p>
            `;
            results.appendChild(div);
        }

        // Test 1: Basic sparse attribute
        console.log('Running Test 1: Basic sparse attribute');
        const prefix = 'data-';
        const id = 'test-id';
        const suffix = '-end';

        render(container, html`
            <div class="${prefix}${id}${suffix}">Basic sparse attribute</div>
        `);

        const element1 = container.querySelector('div');
        const expected1 = 'data-test-id-end';
        const actual1 = element1.className;
        addResult('Test 1: Basic sparse attribute', actual1 === expected1, expected1, actual1);

        // Test 2: Multiple interpolations
        console.log('Running Test 2: Multiple interpolations');
        const part1 = 'hello';
        const part2 = 'world';
        const part3 = 'test';

        render(container, html`
            <div data-value="${part1}-${part2}-${part3}">Multiple interpolations</div>
        `);

        const element2 = container.querySelector('div[data-value]');
        const expected2 = 'hello-world-test';
        const actual2 = element2 ? element2.getAttribute('data-value') : 'null';
        addResult('Test 2: Multiple interpolations', actual2 === expected2, expected2, actual2);

        // Test 3: Responsive updates
        console.log('Running Test 3: Responsive updates');
        let dynamic1 = 'first';
        let dynamic2 = 'second';

        function updateTest() {
            render(container, html`
                <div title="${dynamic1}-${dynamic2}" id="dynamic">Responsive updates</div>
            `);
        }

        updateTest();
        const element3 = container.querySelector('#dynamic');
        const initial = element3.getAttribute('title');

        dynamic1 = 'updated';
        dynamic2 = 'values';
        updateTest();
        const updated = element3.getAttribute('title');
        
        const expected3 = 'updated-values';
        addResult('Test 3: Responsive updates', updated === expected3, expected3, updated);

        // Test 4: Mixed with regular attributes
        console.log('Running Test 4: Mixed with regular attributes');
        render(container, html`
            <div 
                class="${'prefix'}-${'suffix'}" 
                id="regular-attr"
                data-single="${'single'}">
                Mixed attributes
            </div>
        `);

        const element4 = container.querySelector('#regular-attr');
        const className = element4.className;
        const singleAttr = element4.getAttribute('data-single');
        
        const expectedClass = 'prefix-suffix';
        const expectedSingle = 'single';
        addResult('Test 4a: Sparse class', className === expectedClass, expectedClass, className);
        addResult('Test 4b: Regular attribute', singleAttr === expectedSingle, expectedSingle, singleAttr);

        console.log('All tests completed!');
    </script>
</body>
</html> 